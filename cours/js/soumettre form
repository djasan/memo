Dans le chapitre prÃ©cÃ©dent, nous avons constatÃ© que les diffÃ©rents types de balises sont rangÃ©s Ã  lâ€™intÃ©rieur dâ€™une balise plus gÃ©nÃ©rique : la balise form. Cette derniÃ¨re est gÃ©nÃ©ralement associÃ©e Ã  un bouton qui permet de valider le formulaire en envoyant un submit (ou soumission, en franÃ§ais).

Dans ce chapitre, nous allons ajouter un formulaire Ã  notre application pour permettre Ã  lâ€™utilisateur de communiquer son score Ã  un ami. Pour y parvenir, nous aurons donc recours Ã  lâ€™Ã©vÃ©nement submit ! Voici un aperÃ§u de ce que nous devrions obtenir :

                                              Capture d'Ã©cran du formulaire Ã  rÃ©aliser. Il contient un titre, deux champs texte et adresse et un bouton envoyer.

Mais avant de rentrer dans le vif du sujet, je vous propose de revenir sur le fonctionnement dâ€™un site web, et les particularitÃ©s de l'Ã©vÃ©nement submit.
ApprÃ©hendez le fonctionnement client/serveur

Pour comprendre la particularitÃ© de l'Ã©vÃ©nement submit, il est important de comprendre comment fonctionne un site web. ğŸ˜‰

    Votre navigateur (Chrome ou Firefox, par exemple) est un client. Il envoie une requÃªte HTTP Ã  un serveur pour demander des ressources telles quâ€™une page HTML, un fichier CSS ou un script JavaScript.

    Le serveur reÃ§oit la requÃªte et la traite Ã  lâ€™aide dâ€™un langage â€œserveurâ€ (PHP, Python, Node.jsâ€¦), et retourne une rÃ©ponse. 

    Lorsque le navigateur reÃ§oit le fichier, il lâ€™interprÃ¨te et affiche la page. 

Le principe est le mÃªme lorsquâ€™une page HTML affiche un formulaire :

    L'Ã©vÃ©nement submit est lancÃ© au clic sur le bouton â€œEnvoyerâ€. 

    Le navigateur envoie les donnÃ©es au serveur.

    Le serveur les interprÃ¨te, et retourne une nouvelle page Ã  afficher. 

Par consÃ©quent, la page est rechargÃ©e au clic sur le bouton Envoyer.
Illustration du fonctionnement dâ€™un serveur HTTP en 7 Ã©tapes : depuis l'URL rentrÃ© par l'utilisateur dans le navigateur jusqu'au traitement des informations par le serveur.

Ceci est le comportement par dÃ©faut du navigateur. Cependant, lorsque nous traitons nous-mÃªmes le contenu du formulaire en JavaScript, lâ€™Ã©vÃ©nement submit pose un problÃ¨me. Ã‰tant donnÃ© que lâ€™Ã©vÃ©nement a envoyÃ© des donnÃ©es et rÃ©cupÃ©rÃ© une rÃ©ponse du serveur, il provoque un rechargement de la page. ğŸ˜±

Heuuuâ€¦ En quoi câ€™est un problÃ¨me ?

Le rechargement de la page empÃªche lâ€™exÃ©cution du code ! Pour traiter nous-mÃªmes le contenu du formulaire, nous devons donc empÃªcher ce comportement par dÃ©faut, et dire au navigateur â€œInutile dâ€™envoyer des donnÃ©es au serveur, nous allons gÃ©rer nous-mÃªmes cet Ã©vÃ©nement submitâ€. 
EmpÃªchez le comportement par dÃ©faut de l'Ã©vÃ©nement â€œsubmitâ€

Nous lâ€™avons vu, lâ€™Ã©vÃ©nement submit a ceci de particulier quâ€™il provoque un rechargement automatique de la page lorsquâ€™il est envoyÃ©.

    Voyons ensemble avec un exemple comment gÃ©rer ce comportement :

<form>

    <!-- champ nom -->

    <label for="nom">Nom</label>

    <input type="text" id="nom" name="nom" placeholder="Votre nom">


    <!-- champ email -->

    <label for="email">Email</label>

    <input type="email" id="email" name="email" placeholder="Votre email">


    <!-- bouton de validation -->

    <button>Envoyer</button>

</form>

Lorsque lâ€™on clique sur le bouton Envoyer, lâ€™Ã©vÃ©nement submit est envoyÃ©, et le navigateur veut envoyer les donnÃ©es au serveur et rÃ©afficher la page. 

Pour empÃªcher ce comportement par dÃ©faut, nous allons donc :

    Ã©couter cet Ã©vÃ©nement submit ;

    empÃªcher ce comportement grÃ¢ce Ã  la mÃ©thode preventDefault.

    Voici un exemple :

    const form = document.querySelector('form');


    // Quand on submit

    form.addEventListener("submit", (event) => {

        // On empÃªche le comportement par dÃ©faut

        event.preventDefault();

        console.log("Il nâ€™y a pas eu de rechargement de page");

});

Une fois que nous avons rÃ©digÃ© le preventDefault, nous pouvons traiter le contenu du formulaire. Par exemple, en affichant les valeurs du formulaire dans un console.log :

form.addEventListener("submit", (event) => {

    // On empÃªche le comportement par dÃ©faut

    event.preventDefault();

    console.log("Il nâ€™y a pas eu de rechargement de page");


    // On rÃ©cupÃ¨re les deux champs et on affiche leur valeur

    const nom = document.getElementById("nom").value;

    const email = document.getElementById("email").value;

    console.log(nom);

    console.log(email);

});

Ici, au clic sur Envoyer, la valeur du nom et de lâ€™e-mail apparaÃ®t dans la console. Bien sÃ»r, vous pouvez insÃ©rer ici le traitement de votre choix au lieu dâ€™un console.log.
RÃ©capitulons en vidÃ©o

Retrouvez les dÃ©monstrations de ce chapitre dans la vidÃ©o ci-dessous :
Ã€ vous de jouer !

Notre application est fonctionnelle. Notre objectif est maintenant de permettre Ã  lâ€™utilisateur de partager son score avec un ami.

Jâ€™ai donc ajoutÃ© un bouton â€œPartagerâ€ Ã  notre projet. Ainsi, au clic sur le bouton, une popup apparaÃ®t et affiche un formulaire.

Capture d'Ã©cran de la pop up. Elle contient un titre, deux champs et un bouton

Pour rÃ©aliser cet exercice :

    Ã©coutez lâ€™Ã©vÃ©nement submit sur ce nouveau formulaire, et empÃªchez le comportement par dÃ©faut de se produire ;

    rÃ©cupÃ©rez les valeurs des champs prÃ©sents ;

    crÃ©ez une variable sujet et une variable message, et affichez-les dans la console ; 

    utilisez la mÃ©thode afficherEmail que je vous ai prÃ©parÃ©e, avec les bons arguments pour afficher lâ€™e-mail Ã  envoyer, prÃ©rempli avec les bonnes informations. 

CorrigÃ©

Vous pouvez vÃ©rifier votre travail en consultant le corrigÃ© et la vidÃ©o ci-dessous :
En rÃ©sumÃ©

    Un navigateur est un client HTTP. Il fait appel au serveur pour rÃ©cupÃ©rer les informations sur la page quâ€™il veut afficher.

    Lorsquâ€™un utilisateur valide un formulaire, lâ€™Ã©vÃ©nement submit est envoyÃ©. 

    Lorsqu'un Ã©vÃ©nement submit est envoyÃ©, par dÃ©faut, il provoque un appel au serveur. Cela gÃ©nÃ¨re un rechargement de la page qui empÃªche l'exÃ©cution du code.

    Pour Ã©viter ce comportement par dÃ©faut : 

        Ã©coutez lâ€™Ã©vÃ©nement submit ;

        empÃªchez le comportement avec la mÃ©thode preventDefault.
